<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø±ÙÙ‚Ù‘Ø© Ø§Ù„Ù†Ø³Ø§Ø¦ÙŠØ© ğŸ’–</title>
<style>
body {margin:0;font-family:"Cairo",sans-serif;background:linear-gradient(180deg,#ffe6f2,#fdd8f5,#f3c5f9);color:#4a004a;display:flex;flex-direction:column;height:100vh;}
header {display:flex;justify-content:space-between;align-items:center;background:rgba(255,255,255,0.7);padding:10px 15px;border-bottom:2px solid #ffb6d1;backdrop-filter:blur(8px);}
header h1 {font-size:1.6em;color:#c80064;font-weight:700;margin:0;}
.admin-btn {font-size:1.8em;color:#ff1493;cursor:pointer;transition:0.3s;}
.admin-btn:hover {transform:scale(1.2);}
#search {margin:10px auto;width:90%;padding:8px 12px;border-radius:25px;border:none;outline:none;box-shadow:0 2px 6px rgba(255,105,180,0.4);}
main {flex:1;overflow-y:auto;padding:15px;}
footer {display:flex;justify-content:space-around;align-items:center;background:rgba(255,255,255,0.9);border-top:2px solid #ffc0cb;padding:10px 0;}
footer button {background:none;border:none;font-size:1.4em;color:#c80064;cursor:pointer;transition:0.2s;}
footer button:hover {transform:scale(1.2);}
.post {background:#fff;margin:10px 0;padding:10px;border-radius:12px;box-shadow:0 2px 6px rgba(0,0,0,0.1);}
.post-actions {display:flex;justify-content:space-around;padding-top:8px;font-size:1.2em;}
.post-actions button {border:none;background:linear-gradient(90deg,#ffb6d1,#fdb5e1);padding:5px 10px;border-radius:20px;cursor:pointer;font-size:1em;color:#4a004a;box-shadow:0 2px 5px rgba(0,0,0,0.1);}
.post-actions button:hover {transform:scale(1.05);}
#adminPanel {position:fixed;top:0;right:0;bottom:0;left:0;background:rgba(255,255,255,0.98);display:none;flex-direction:column;padding:20px;overflow-y:auto;z-index:999;}
.hidden {display:none;}
.ai-btn {background:linear-gradient(90deg,#ff6fb2,#ff99cc);border:none;color:white;padding:10px 15px;border-radius:25px;margin:10px 0;font-size:1em;cursor:pointer;}
.ai-btn:hover {background:linear-gradient(90deg,#ff99cc,#ff6fb2);}
textarea {width:100%;border-radius:10px;padding:8px;margin-bottom:8px;}
</style>
</head>
<body>

<header>
  <h1>Ø±ÙÙ‚Ù‘Ø© ğŸ’–</h1>
  <span class="admin-btn" onclick="openAdmin()">â¤ï¸</span>
</header>

<input type="text" id="search" placeholder="Ø§Ø¨Ø­Ø«ÙŠ Ù‡Ù†Ø§ ÙŠØ§ Ø±Ù‚ÙŠÙ‚Ø©...">

<main id="content">
  <p style="text-align:center;color:#c80064;font-weight:500;">âœ¨ Ø§Ø®ØªØ§Ø±ÙŠ Ù‚Ø³Ù…Ùƒ Ø§Ù„Ø¬Ù…ÙŠÙ„ Ù…Ù† Ø§Ù„Ø£Ø³ÙÙ„ âœ¨</p>
</main>

<footer>
  <button onclick="openSection('mashaer')">ğŸ’</button>
  <button onclick="openSection('fiqh')">ğŸŒ¸</button>
  <button onclick="openSection('relations')">ğŸ’‹</button>
  <button onclick="openSection('health')">ğŸ’—</button>
  <button onclick="openSection('community')">ğŸ¤</button>
</footer>

<div id="adminPanel">
  <h2>Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù† ğŸ’¼</h2>
  <div id="loginArea">
    <input id="adminUser" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
    <input id="adminPass" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±">
    <button class="ai-btn" onclick="loginAdmin()">Ø¯Ø®ÙˆÙ„</button>
  </div>

  <div id="adminContent" class="hidden">
    <h3>Ù…Ø±Ø­Ø¨Ø§Ù‹ ÙŠØ§ Ø±Ù‚ÙŠÙ‚Ø© Zazo ğŸŒ¸</h3>
    <select id="adminSection">
      <option value="mashaer">ğŸ’ Ø§Ù„Ù…Ø´Ø§Ø¹Ø±</option>
      <option value="fiqh">ğŸŒ¸ ÙÙ‚Ù‡ Ø§Ù„Ù†Ø³Ø§Ø¡</option>
      <option value="relations">ğŸ’‹ Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª Ø§Ù„Ø­Ù…ÙŠÙ…ÙŠØ©</option>
      <option value="health">ğŸ’— Ø§Ù„ØµØ­Ø©</option>
      <option value="community">ğŸ¤ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹</option>
    </select>

    <button class="ai-btn" onclick="generateAIContent()">âœ¨ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø­ØªÙˆÙ‰ Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„ØµÙ†Ø§Ø¹ÙŠ</button>

    <textarea id="adminText" rows="5" placeholder="Ø§ÙƒØªØ¨ÙŠ Ø§Ù„Ø¨ÙˆØ­ Ø§Ù„Ø¬Ù…ÙŠÙ„ Ù‡Ù†Ø§..."></textarea>
    <button class="ai-btn" onclick="addPost()">ğŸ’Œ Ø¥Ø¶Ø§ÙØ© Ø¨ÙˆØ­ Ø¬Ù…ÙŠÙ„</button>

    <input type="file" id="videoUpload" accept="video/*" style="margin-top:10px;">
    <button class="ai-btn" onclick="uploadVideo()">ğŸ¥ Ø±ÙØ¹ ÙÙŠØ¯ÙŠÙˆ</button>

    <div id="adminPosts"></div>
    <button class="ai-btn" style="background:#f88;" onclick="closeAdmin()">Ø®Ø±ÙˆØ¬</button>
  </div>
</div>

<script>
let currentSection="";
let isAdmin=false;

// ÙØªØ­ Ø§Ù„Ù‚Ø³Ù… ÙˆØ¹Ø±Ø¶ Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª ÙˆØ§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª
function openSection(section){
  currentSection = section;
  fetchSectionContent();
}

// Ø¬Ù„Ø¨ ÙƒÙ„ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù‚Ø³Ù… (Ù…Ù†Ø´ÙˆØ±Ø§Øª + ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª)
async function fetchSectionContent(){
  let htmlContent = "";

  // Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª
  try {
    const resPosts = await fetch("/api/get_posts", {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({section: currentSection})
    });
    const dataPosts = await resPosts.json();
    if(dataPosts.posts.length === 0){
      htmlContent += "<p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨ÙˆØ­ Ø¨Ø¹Ø¯ ğŸŒ¸</p>";
    } else {
      dataPosts.posts.forEach(p => {
        htmlContent += `
          <div class="post">
            <p>${p.text}</p>
            <div class="post-actions">
              <button onclick="likePost('${p.id}')">â¤ï¸ Ø¥Ø¹Ø¬Ø§Ø¨</button>
              <button onclick="commentPost('${p.id}')">ğŸ’¬ ØªØ¹Ù„ÙŠÙ‚</button>
              <button onclick="shareContent('${p.text}')">ğŸ”„ Ù…Ø´Ø§Ø±ÙƒØ©</button>
            </div>
          </div>`;
      });
    }
  } catch(e){ console.log(e); htmlContent += "<p>Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª</p>"; }

  // Ø¬Ù„Ø¨ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª
  try {
    const resVideos = await fetch("/api/get_videos", {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({section: currentSection})
    });
    const dataVideos = await resVideos.json();
    dataVideos.videos.forEach(v => {
      htmlContent += `
        <div class="post">
          <video src="${v.src}" controls width="100%" style="border-radius:10px;"></video>
        </div>`;
    });
  } catch(e){ console.log(e); }

  document.getElementById("content").innerHTML = htmlContent;
}

// ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨ ÙˆØ§Ù„ØªØ¹Ù„ÙŠÙ‚ ÙˆØ§Ù„Ù…Ø´Ø§Ø±ÙƒØ©
function likePost(id){ alert("ØªÙ… Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨ Ø¨Ø§Ù„Ø¨ÙˆØ­ ğŸ’–"); }
function commentPost(id){ const c=prompt("Ø£Ø¯Ø®Ù„ÙŠ ØªØ¹Ù„ÙŠÙ‚Ùƒ ğŸ’¬"); if(c) alert("ØªÙ… Ø§Ù„ØªØ¹Ù„ÙŠÙ‚ ğŸŒ¸"); }
function shareContent(text){ 
  if(navigator.share) navigator.share({text}); 
  else { navigator.clipboard.writeText(text); alert("ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø¨ÙˆØ­ ğŸ’–"); } 
}

function openAdmin(){ document.getElementById("adminPanel").style.display="flex"; }
function closeAdmin(){ document.getElementById("adminPanel").style.display="none"; }

function loginAdmin(){
  const u=document.getElementById("adminUser").value;
  const p=document.getElementById("adminPass").value;
  if(u==="zazo" && p==="zazo010988"){
    isAdmin=true;
    document.getElementById("loginArea").classList.add("hidden");
    document.getElementById("adminContent").classList.remove("hidden");
  } else alert("Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø© ğŸ’”");
}

async function generateAIContent(){
  const section=document.getElementById("adminSection").value;
  try{
    const res=await fetch("/api/ai/generate",{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({section})
    });
    const data=await res.json();
    document.getElementById("adminText").value=data.text||"ğŸ’– Ù„Ù… ÙŠØµÙ„ Ø±Ø¯ Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…";
  }catch(e){alert("âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…");}
}

async function addPost(){
  if(!isAdmin) return alert("ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„");
  const section=document.getElementById("adminSection").value;
  const txt=document.getElementById("adminText").value.trim();
  if(!txt) return alert("Ø£ÙƒØªØ¨ÙŠ Ø´ÙŠØ¦Ù‹Ø§ Ø¬Ù…ÙŠÙ„Ù‹Ø§ ğŸŒ·");
  await fetch("/api/add_post",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({section,content:txt})
  });
  document.getElementById("adminText").value="";
  fetchSectionContent();
  alert("ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨ÙˆØ­ Ø§Ù„Ø¬Ù…ÙŠÙ„ ğŸ’–");
}

function uploadVideo(){
  if(!isAdmin) return alert("ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„");
  const file=document.getElementById("videoUpload").files[0];
  if(!file) return alert("Ø§Ø®ØªØ§Ø±ÙŠ ÙÙŠØ¯ÙŠÙˆ Ø£ÙˆÙ„Ø§Ù‹ ğŸ¥");
  const section=document.getElementById("adminSection").value;
  const form=new FormData();
  form.append("file",file);
  form.append("section",section);
  fetch("/api/upload_video",{method:"POST",body:form})
    .then(res=>res.json())
    .then(data=>{
      if(data.status==="success"){ fetchSectionContent(); alert("ØªÙ… Ø±ÙØ¹ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ğŸ’—"); }
      else alert(data.message);
    });
}
</script>
</body>
</html>
